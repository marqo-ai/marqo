from unittest import TestCase

import numpy as np

from marqo.s2_inference.clip_utils import OPEN_CLIP
from marqo.s2_inference.model_registry import _get_open_clip_properties
from marqo.s2_inference.s2_inference import clear_loaded_models

OPEN_CLIP_MODEL_PROPERTIES = _get_open_clip_properties()


class TestMarqoFashionCLIP(TestCase):
    """A test class for Marqo Fashion CLIP model.

    There are generally 3 parts in a OpenCLIP model:
    1. Model,
    2. Tokenizer, and
    3. Image preprocessor.

    We need to ensure all these parts are working as expected.
    """

    IMAGE_CONTENT = "https://github.com/marqo-ai/marqo-FashionCLIP/blob/main/docs/fashion-hippo.png?raw=true"
    TEXT_CONTENT = "a hat"

    FASHIONCLIP_IMAGE_EMBEDDING = np.squeeze(np.array([
        [
            -5.5725e-02, -6.1073e-03, -1.1017e-01, -4.7852e-02, 2.4658e-02,
            -1.2901e-02, -1.2457e-01, -3.0777e-02, -7.7026e-02, 4.2969e-02,
            4.1046e-03, -6.2752e-03, -3.6011e-02, -2.2781e-02, 1.7120e-02,
            -2.4872e-02, 9.0759e-02, 1.7609e-02, -1.3977e-02, 4.3304e-02,
            -3.4119e-02, 1.2573e-02, 6.4453e-02, 7.4280e-02, 5.1727e-02,
            5.3009e-02, 2.5253e-02, 6.2073e-02, -2.8687e-02, -3.6163e-02,
            2.3865e-02, -1.0506e-02, 5.1147e-02, -6.6757e-03, 2.1393e-02,
            1.5450e-02, -3.7994e-02, -1.2131e-03, 1.2999e-03, -2.6657e-02,
            -1.1925e-02, 1.5160e-02, 1.3252e-02, -1.3971e-03, 3.5645e-02,
            -5.7587e-02, -1.0150e-01, 1.7517e-02, -4.9500e-02, 1.5190e-02,
            -7.0557e-02, 1.9867e-02, 2.9160e-02, -3.1021e-02, -6.6833e-02,
            1.2962e-02, -3.9062e-03, -3.6713e-02, 1.9531e-03, 3.3539e-02,
            5.5054e-02, -6.8817e-03, 1.7242e-02, 1.2756e-02, -2.6520e-02,
            1.2772e-02, 3.4790e-02, -1.6069e-03, -3.9948e-02, 7.9163e-02,
            7.9346e-02, -2.2621e-03, 2.6588e-03, -5.7259e-03, -6.6650e-02,
            1.6312e-02, 2.2324e-02, -1.0567e-02, -2.1400e-03, -4.0833e-02,
            3.0075e-02, -5.9357e-03, 1.2115e-02, -6.8298e-02, 4.5258e-02,
            -3.2440e-02, 4.0161e-02, -3.0632e-03, 7.5607e-03, 2.5833e-02,
            2.5925e-02, 4.6692e-02, -5.8990e-02, -5.0476e-02, 7.5760e-03,
            1.7548e-02, 2.8976e-02, -2.9175e-02, -8.6365e-02, -3.5248e-02,
            -1.2573e-02, -1.3763e-02, 9.0866e-03, 4.0817e-03, -1.1108e-02,
            -3.2562e-02, -3.5706e-02, 1.1765e-02, 5.7709e-02, -2.0523e-03,
            -9.6741e-02, 2.0691e-02, 8.2764e-02, -2.9240e-03, 7.3730e-02,
            -2.1896e-02, 1.9180e-02, 4.9652e-02, 3.6896e-02, 2.4109e-02,
            2.9449e-02, -1.3779e-02, -5.7190e-02, 8.9169e-04, 2.9327e-02,
            6.0486e-02, 4.5776e-02, 1.6205e-02, -1.3794e-02, 5.0629e-02,
            5.5573e-02, 2.2278e-02, -7.2876e-02, 9.3842e-04, -6.7810e-02,
            -1.9875e-03, 2.6306e-02, -5.6763e-02, -3.8910e-02, -4.0771e-02,
            -2.2598e-02, 1.6418e-01, 1.2109e-01, -2.0737e-02, -2.0462e-02,
            -4.8027e-03, 4.6173e-02, 7.3395e-03, 5.6702e-02, -4.2297e-02,
            -2.6566e-02, -3.4866e-03, -2.8305e-02, 4.2229e-03, -2.3060e-03,
            5.5504e-03, -7.9346e-03, -1.6006e-02, 3.4119e-02, 2.6413e-02,
            1.0461e-01, 3.1921e-02, 9.7427e-03, 3.3875e-02, 8.4534e-03,
            3.5645e-02, -5.5420e-02, -5.7945e-03, -4.0680e-02, -2.9541e-02,
            -5.7892e-02, 5.4413e-02, 7.6111e-02, -1.8520e-03, -8.4763e-03,
            7.1106e-02, 1.3840e-02, -5.1193e-03, 3.2776e-02, -6.3019e-03,
            -5.0598e-02, -1.1072e-01, 4.0771e-02, -3.0640e-02, -4.3396e-02,
            3.1830e-02, -2.6016e-02, 2.3941e-02, 3.0792e-02, 6.1554e-02,
            1.6413e-03, 1.0490e-02, -2.1637e-02, -1.7151e-02, -3.3844e-02,
            6.3171e-02, 4.7119e-02, -5.0873e-02, 3.1555e-02, 3.1372e-02,
            -7.4844e-03, -2.7943e-04, 6.3095e-03, 5.5504e-03, -1.1234e-03,
            -3.1204e-02, 1.4633e-02, 4.5593e-02, 2.1362e-03, -6.0730e-02,
            -8.3069e-02, 2.5158e-03, -4.2114e-02, -3.2043e-02, 2.5360e-02,
            5.9540e-02, -2.2522e-02, -2.3148e-02, -1.6037e-02, 6.2012e-02,
            2.3010e-02, -7.6965e-02, -3.8208e-02, 6.9046e-03, 1.5210e-01,
            6.8016e-03, 3.7766e-03, -3.8239e-02, -2.3682e-02, 4.3488e-02,
            -3.2568e-01, -1.4877e-02, 3.2013e-02, 2.0660e-02, 2.8564e-02,
            -5.5450e-02, 4.8004e-02, 8.9493e-03, 6.7566e-02, -3.2837e-02,
            -4.0863e-02, 2.0542e-03, 1.5839e-02, 3.8727e-02, 1.3123e-02,
            -4.5776e-02, 4.1534e-02, 8.6853e-02, 3.0121e-02, 6.6261e-03,
            2.4918e-02, -2.0233e-02, 7.4844e-03, -2.3453e-02, -7.9468e-02,
            -1.7868e-02, -2.6855e-03, -1.6891e-02, -1.0260e-01, 5.3644e-04,
            1.6647e-02, -6.1249e-02, 4.1321e-02, 2.6001e-02, -2.2774e-03,
            -3.5950e-02, 1.5610e-02, 9.8114e-03, -4.3983e-03, 3.1738e-02,
            7.5645e-03, 1.2646e-03, -1.3489e-02, -3.1185e-03, -4.4769e-02,
            -1.1921e-03, -4.2439e-04, 1.6129e-02, -3.5950e-02, -2.1072e-02,
            -3.5381e-03, -8.0627e-02, 4.8431e-02, 7.3547e-02, 3.4424e-02,
            -1.2360e-02, 5.9235e-02, -1.4595e-02, 1.1108e-02, 6.8970e-03,
            1.6617e-02, 2.0325e-02, 1.0767e-01, 1.2047e-02, -4.0894e-02,
            2.3590e-02, -2.0599e-02, 3.5614e-02, -3.3752e-02, -1.2585e-01,
            3.0502e-02, 2.4292e-02, -2.1484e-02, -5.3528e-02, -5.2002e-02,
            4.9194e-02, 3.1158e-02, 9.1324e-03, 9.8389e-02, -2.5879e-02,
            -4.6783e-02, 2.7847e-03, -1.3321e-02, -1.5900e-02, -2.3972e-02,
            -4.9744e-02, -3.4084e-03, -6.4148e-02, 6.3591e-03, -9.2041e-02,
            -1.4442e-02, -1.0826e-02, -2.3178e-02, -3.3356e-02, 7.0740e-02,
            -2.1484e-02, 1.6632e-02, 4.4647e-02, -5.9280e-03, 2.8229e-03,
            1.0475e-02, -2.3865e-02, -1.1765e-02, -4.0054e-03, -2.2629e-02,
            9.6054e-03, 2.4368e-02, -2.0630e-02, -1.8280e-02, -3.2654e-02,
            -2.8610e-02, -3.3783e-02, -2.5925e-02, -2.3361e-02, -1.4946e-02,
            1.5778e-02, -7.3242e-02, -6.4754e-04, 1.3916e-01, -7.2754e-02,
            -2.3178e-02, -2.6901e-02, 4.9591e-02, 7.3242e-02, 4.2297e-02,
            1.3130e-02, 9.7229e-02, 3.1494e-02, 8.4839e-02, -2.7752e-03,
            2.7802e-02, -1.2550e-02, 5.2155e-02, 7.2083e-02, -2.4750e-02,
            3.4912e-02, -2.8305e-02, 3.0396e-02, -1.7181e-02, 3.9276e-02,
            2.5654e-04, -3.6068e-03, -1.3924e-02, -6.6719e-03, 1.6068e-02,
            1.1711e-02, 2.1179e-02, 2.5635e-03, 8.2397e-03, -9.5825e-03,
            2.1332e-02, 5.9433e-03, 1.8280e-02, -2.1500e-02, 1.4633e-02,
            3.9734e-02, -1.6922e-02, 2.4967e-03, 5.2757e-03, -5.8403e-03,
            -1.5686e-02, -1.0506e-02, 1.7334e-02, -9.1675e-02, 3.8879e-02,
            -4.3365e-02, -2.6155e-04, -5.5962e-03, 8.0643e-03, 2.3804e-02,
            3.7327e-03, -1.4648e-02, -1.9073e-02, 2.5391e-02, -1.9272e-02,
            1.3924e-02, 1.4328e-02, 4.2511e-02, 5.3375e-02, -1.8082e-02,
            1.3452e-01, -4.5929e-02, 1.7975e-02, -4.3030e-02, 3.9482e-04,
            1.2306e-02, -4.3243e-02, 1.7487e-02, -1.1237e-01, -2.9755e-02,
            1.9867e-02, -5.5481e-02, 2.7512e-02, -4.3304e-02, 2.4475e-02,
            -4.9957e-02, 3.2074e-02, -9.3567e-02, 1.3603e-02, 3.9673e-02,
            1.8250e-02, 7.0572e-03, 5.2368e-02, 3.7880e-03, -3.8910e-03,
            -3.6896e-02, 2.2690e-02, -2.4979e-02, 1.7738e-03, -2.7222e-02,
            -3.2074e-02, 7.6660e-02, 5.4588e-03, 2.2476e-02, 4.2725e-03,
            6.2195e-02, 4.1779e-02, 2.8290e-02, 2.7580e-03, 8.5449e-02,
            -4.2603e-02, -7.2998e-02, 3.1006e-02, 7.4272e-03, 1.2383e-02,
            -8.5205e-02, 6.8787e-02, -1.0872e-02, -3.1250e-02, 3.2288e-02,
            5.0629e-02, -7.0618e-02, 1.1841e-02, -1.0181e-01, 1.0605e-02,
            4.2511e-02, 9.2697e-03, -1.3977e-02, 1.1681e-02, -1.2337e-02,
            3.5645e-02, -5.1117e-02, 3.9673e-02, 3.1891e-02, -9.1614e-02,
            -2.5208e-02, 1.0361e-02, 4.6272e-03, -4.0527e-02, 6.0547e-02,
            1.9882e-02, 3.7174e-03, 3.5828e-02, 5.5115e-02, -2.1667e-03,
            -4.2000e-03, -3.9185e-02, 4.0649e-02, -4.7729e-02, -2.2568e-02,
            7.1045e-02, -1.0536e-02, 1.4740e-02, -1.0788e-02, 4.2358e-02,
            -2.8976e-02, 1.7181e-02, -1.9974e-02, 4.2999e-02, -3.6285e-02,
            -4.2999e-02, 4.0497e-02, -2.9007e-02, 2.2339e-02, 2.5314e-02,
            -3.3295e-02, -7.2823e-03, 3.1769e-02, 1.0139e-02, -6.7932e-02,
            -3.6804e-02, -2.6260e-02
        ]
    ]))

    FASHIONCLIP_TEXT_EMBEDDING = np.squeeze(np.array([
        [
            -2.6367e-02, 1.2276e-02, -7.1716e-03, -1.1559e-02, 9.5654e-04,
            2.2583e-02, -4.5052e-03, -1.8921e-02, -1.0292e-02, -3.5496e-03,
            -1.8967e-02, -2.8931e-02, 3.0685e-02, 1.2077e-02, 1.0551e-02,
            -3.4058e-02, 3.1219e-02, -1.0445e-02, 2.1667e-02, -1.2321e-02,
            6.3057e-03, 2.3849e-02, -3.5126e-02, 2.0035e-02, 1.0124e-02,
            7.0251e-02, -4.2084e-02, 8.8272e-03, -3.6011e-02, 1.4198e-02,
            2.2446e-02, 9.9945e-03, 4.1389e-03, 2.0172e-02, 7.5226e-03,
            -1.0307e-02, -8.3313e-02, 3.3020e-02, 4.7058e-02, 1.8372e-02,
            1.4610e-02, -1.4786e-02, -5.1514e-02, 5.0583e-03, -1.6693e-02,
            -4.2877e-03, -4.3488e-02, 6.0272e-02, 3.3081e-02, 7.8430e-02,
            -3.6682e-02, 1.6708e-02, -9.6283e-03, 5.1270e-03, 1.7761e-02,
            2.5139e-03, 3.8208e-02, -2.9358e-02, -1.9562e-02, 2.5009e-02,
            -1.0979e-02, 4.3243e-02, -4.8332e-03, -1.8387e-02, 2.5726e-02,
            4.2206e-02, 4.1504e-03, 5.9624e-03, -3.6621e-02, -2.6798e-03,
            -5.8556e-03, -2.3712e-02, -6.1859e-02, -1.1497e-02, -2.7103e-03,
            2.6031e-02, -1.5617e-02, 5.6229e-03, 1.4000e-03, -9.9243e-02,
            -3.3386e-02, -1.3130e-02, -2.6138e-02, -1.5778e-02, 5.1636e-02,
            9.8038e-03, 7.4615e-03, 2.9327e-02, -3.9062e-02, 4.8035e-02,
            -4.9713e-02, -1.1528e-02, 3.0273e-02, 1.7883e-02, -7.6218e-03,
            3.6011e-02, 9.9945e-03, -1.4488e-02, -4.2114e-02, 1.5686e-02,
            3.9612e-02, -2.9999e-02, -3.1677e-02, 3.3539e-02, 9.7122e-03,
            -1.5686e-02, -1.0506e-02, 6.3843e-02, -3.4657e-03, -4.3488e-02,
            -2.3499e-02, -1.4862e-02, 6.1127e-02, -2.9419e-02, 5.6854e-02,
            -3.0613e-03, 3.9246e-02, 1.2718e-02, -1.6220e-02, 4.3797e-04,
            -2.0233e-02, -4.3488e-02, -5.7068e-03, -2.6855e-02, -5.5145e-02,
            2.9869e-03, -2.7969e-02, -2.2812e-02, -4.0070e-02, 3.5496e-03,
            2.7466e-03, 2.7939e-02, 1.0391e-02, 3.4821e-02, -6.4545e-03,
            -5.2429e-02, -1.3565e-02, -3.5614e-02, -7.9422e-03, 5.5450e-02,
            -3.8086e-02, 6.5186e-02, -2.5894e-02, -2.8397e-02, -1.8585e-02,
            1.2810e-02, 1.4709e-02, 1.6251e-02, -4.3427e-02, -2.5009e-02,
            -4.0100e-02, 1.8225e-03, 4.0680e-02, 1.4847e-02, 8.1940e-03,
            -9.9716e-03, -3.6530e-02, 6.2988e-02, 3.7292e-02, -1.8799e-02,
            7.3853e-02, 2.9282e-02, -5.4749e-02, -1.2444e-02, -1.0132e-02,
            -1.4854e-02, -8.3313e-03, 3.4698e-02, -4.3457e-02, -2.4643e-02,
            3.9795e-02, -1.0216e-02, 6.1462e-02, -1.8524e-02, -4.7951e-03,
            3.1952e-02, 1.4999e-02, -3.4760e-02, -3.9172e-04, 2.4834e-03,
            -1.1749e-03, -3.1830e-02, 4.0039e-02, -3.6804e-02, -1.4107e-02,
            6.1218e-02, -1.2894e-02, -3.5400e-03, 1.8524e-02, -1.2585e-01,
            -2.3994e-03, 4.1107e-02, 1.4137e-02, -1.9293e-03, -1.1742e-02,
            2.3163e-02, -2.1835e-02, -4.1229e-02, -2.6855e-02, 3.1174e-02,
            -3.3936e-02, -3.5839e-03, 1.6113e-02, -2.3727e-02, -9.2239e-03,
            3.5492e-02, 2.3003e-03, -2.5589e-02, 2.3224e-02, -1.7410e-02,
            -1.0933e-02, -1.2825e-02, -2.7573e-02, -1.7334e-02, -1.5610e-02,
            8.7678e-05, 1.2581e-02, 9.8114e-03, -3.6835e-02, 2.9266e-02,
            4.6967e-02, -6.0120e-02, -3.7842e-02, -2.2507e-02, 3.3508e-02,
            -3.6682e-02, 7.2266e-02, -4.9973e-03, -2.8992e-02, -1.2939e-02,
            -1.2646e-01, -2.3117e-02, 4.9286e-03, -1.3794e-02, 3.7354e-02,
            5.8655e-02, 2.1973e-02, 6.5765e-03, -1.5434e-02, -8.4290e-02,
            3.7842e-02, 1.0307e-02, 4.6875e-02, -4.8065e-03, -1.5686e-02,
            -1.1742e-02, -7.9575e-03, -2.9007e-02, -1.7822e-02, 4.4556e-02,
            -1.4877e-02, 1.9531e-02, -2.5101e-02, -3.4760e-02, -1.3435e-02,
            -3.4363e-02, -1.1230e-02, 1.0040e-02, 1.7838e-02, 4.3488e-02,
            1.5778e-02, 2.9343e-02, -9.2411e-04, 8.1940e-03, 2.2888e-02,
            -6.9702e-02, 4.1962e-02, 3.9291e-03, 2.2186e-02, 4.2023e-02,
            -3.4485e-03, 8.9874e-03, -4.5967e-03, -1.6632e-02, 2.7893e-02,
            -2.5009e-02, 5.2399e-02, 3.7689e-02, -7.5836e-03, -3.0914e-02,
            -1.4191e-03, -2.7832e-02, 2.2888e-02, 7.2144e-02, 1.6144e-02,
            5.1514e-02, -2.4887e-02, -2.3346e-02, -3.5004e-02, 1.3710e-02,
            8.4915e-03, 7.6866e-03, 5.4359e-03, -2.2156e-02, -1.4214e-02,
            2.9190e-02, 5.0751e-02, -3.2883e-03, -2.4338e-02, 1.1625e-03,
            3.5431e-02, -2.1790e-02, -1.3588e-02, -3.7842e-02, 9.9792e-03,
            3.6469e-02, -1.3494e-03, -1.4061e-02, -1.6785e-02, 5.2605e-03,
            7.3853e-03, 3.2776e-02, -2.6932e-02, -2.2297e-03, -4.6570e-02,
            -1.6083e-02, 7.6523e-03, -8.5068e-03, 3.9291e-03, -8.6212e-03,
            -3.2425e-04, 2.7481e-02, -2.5444e-03, -7.0129e-02, 2.1072e-02,
            -4.2633e-02, 5.0049e-03, 3.0136e-02, 3.5858e-02, -3.1590e-06,
            2.7222e-02, -1.9913e-02, 3.2196e-02, -2.1667e-02, 1.9989e-02,
            1.0864e-02, 5.3009e-02, -4.3793e-03, 4.4647e-02, -9.8495e-03,
            -2.3117e-02, -1.8936e-02, -3.1158e-02, -2.9877e-02, -2.5726e-02,
            -2.8133e-04, -2.5238e-02, -1.1024e-02, -8.9539e-02, 9.3002e-03,
            -2.4643e-02, 2.6913e-03, 1.5610e-02, 2.5005e-03, 6.8970e-02,
            5.0690e-02, 2.8915e-02, 1.9241e-02, 2.5040e-02, 4.4983e-02,
            5.2673e-02, -4.2328e-02, 3.1757e-03, 3.3417e-02, -2.6367e-02,
            4.2145e-02, -4.3823e-02, 5.6267e-03, -1.4595e-02, 6.1302e-03,
            1.6083e-02, 8.4000e-03, 8.4457e-03, -3.4271e-02, 2.5757e-02,
            2.9404e-02, 3.3783e-02, 9.8801e-03, -7.9575e-03, 2.5375e-02,
            -9.9182e-04, 3.0624e-02, -5.8031e-04, -1.5282e-02, 1.6312e-02,
            3.0121e-02, -1.5631e-03, 4.2236e-02, -6.3057e-03, 7.0457e-03,
            -4.3457e-02, -4.3411e-03, -4.7226e-03, 6.0059e-02, 5.0690e-02,
            -1.1055e-02, -5.0568e-02, -5.6305e-03, 5.3825e-03, -6.9092e-02,
            -1.3533e-03, 5.6610e-02, -2.0370e-02, -7.6561e-03, -4.8141e-03,
            1.4782e-03, 3.0380e-02, -5.7709e-02, -8.0032e-03, 1.3588e-02,
            6.1981e-02, -4.8004e-02, -1.1253e-02, 3.4924e-03, 8.2779e-03,
            -2.3621e-02, -1.6449e-02, 2.8503e-02, -1.8707e-02, -2.5528e-02,
            -8.9798e-03, -7.1631e-01, -5.3368e-03, -3.7262e-02, -2.0111e-02,
            -4.3945e-02, 3.2825e-03, -1.0597e-02, 1.8108e-04, -3.7670e-03,
            -1.2215e-02, -4.8676e-02, 1.3428e-02, -4.6234e-02, 1.6159e-02,
            1.0864e-02, -4.4060e-03, -9.1476e-03, -1.2032e-02, 3.1082e-02,
            1.6769e-02, -1.0866e-04, 3.7781e-02, -9.3918e-03, -6.0844e-03,
            -6.5956e-03, -1.0597e-02, 3.5492e-02, -4.5166e-02, 3.6411e-03,
            2.7405e-02, -1.2413e-02, 3.5004e-02, -1.4755e-02, 3.1860e-02,
            1.4977e-02, -1.0567e-02, -3.5461e-02, -2.6703e-02, 1.8661e-02,
            -1.3786e-02, -1.2131e-03, 6.6328e-04, -9.2712e-02, -4.3091e-02,
            -2.2491e-02, -1.0017e-02, -2.5711e-02, -1.5778e-02, 1.7487e-02,
            -2.4811e-02, -6.7673e-03, -2.9114e-02, 3.3607e-03, 4.1351e-02,
            -4.8065e-02, -6.6299e-03, -1.4008e-02, -2.9354e-03, 4.3121e-02,
            1.6846e-02, -2.4307e-02, 4.4037e-02, 3.2318e-02, -2.7908e-02,
            -1.8906e-02, -3.2440e-02, 1.5945e-02, 4.0039e-02, 2.4139e-02,
            4.7699e-02, -2.6031e-02, 2.2888e-02, -1.0101e-02, 4.1695e-03,
            1.5427e-02, 5.3101e-03, 9.6283e-03, 9.8816e-02, 3.4149e-02,
            -1.9562e-02, -2.6215e-02, -3.6499e-02, -2.0996e-02, 4.8981e-02,
            1.7227e-02, 3.6682e-02, 3.1830e-02, 1.9165e-02, -1.6220e-02,
            -3.6896e-02, -5.0583e-03
        ]
    ]))

    SiGLIP_IMAGE_EMBEDDING = np.squeeze(np.array([
        [
            -2.4643e-02, 5.8060e-03, -9.6359e-03, -2.4826e-02, 3.4576e-02,
            4.5746e-02, 5.8594e-03, -7.0572e-03, 3.8757e-02, 2.2259e-03,
            -6.7902e-03, -2.8095e-03, 1.2321e-02, 2.0950e-02, 1.0811e-02,
            1.5457e-02, 1.3336e-02, 7.0143e-04, -5.6686e-03, 1.0834e-02,
            4.1466e-03, 1.7258e-02, -8.0643e-03, 1.8673e-03, 2.7637e-03,
            -1.2978e-02, 2.5772e-02, 4.3907e-03, 5.4108e-02, 2.4438e-05,
            -6.9809e-03, -2.6917e-02, -8.9188e-03, -5.6000e-03, 1.3533e-03,
            5.4131e-03, 4.0375e-02, 6.2256e-03, 1.6586e-02, 1.2150e-03,
            -2.6428e-02, -2.7161e-02, -1.8723e-02, 2.0782e-02, -1.0582e-02,
            5.2887e-02, 2.0390e-03, 6.8893e-03, -2.5436e-02, -1.3748e-02,
            6.1989e-04, -9.1980e-02, 1.4862e-02, 4.0649e-02, -2.8534e-03,
            -4.3121e-02, -3.5229e-03, -1.1902e-02, 2.4628e-02, -2.0157e-02,
            -3.8891e-03, 4.9225e-02, -3.4027e-02, 5.0697e-03, 1.1597e-02,
            2.6901e-02, 8.9874e-03, -1.2787e-02, 1.5249e-03, 3.8490e-03,
            -1.4725e-02, 5.5122e-03, 2.3254e-02, -3.6030e-03, -1.5898e-03,
            2.3239e-02, -2.4826e-02, 2.1408e-02, 3.0054e-01, 1.8051e-02,
            -3.4668e-02, 8.3847e-03, -2.0004e-02, -1.3245e-02, 1.2749e-02,
            -8.0872e-02, -2.3746e-03, 1.0681e-02, 4.4098e-02, 1.8219e-02,
            -4.3518e-02, -1.7944e-02, 3.0670e-02, 1.0925e-02, 5.8441e-02,
            -1.3458e-02, 3.8727e-02, 3.4733e-03, 4.8676e-03, -2.8305e-03,
            1.0132e-02, -4.8447e-03, 1.4677e-03, -1.9562e-02, 4.2391e-04,
            -1.2123e-02, 1.3275e-02, -3.1616e-02, -2.2018e-02, -2.4155e-02,
            -2.0706e-02, 4.5013e-03, 2.1088e-02, 1.4191e-03, -1.5869e-02,
            3.2074e-02, -1.5945e-02, -1.2255e-03, 1.0910e-02, 8.1406e-03,
            6.5079e-03, -5.0323e-02, 8.2169e-03, 1.2451e-02, 8.8257e-02,
            7.5340e-03, 3.6011e-02, 7.9269e-03, 7.1472e-02, 4.8981e-02,
            2.4887e-02, -4.0932e-03, -2.7603e-02, -3.8940e-02, -2.0599e-02,
            -1.2871e-02, 1.1482e-02, 9.9792e-03, 7.2937e-02, -2.8076e-02,
            3.5004e-02, 1.0162e-01, -3.8940e-02, -5.7077e-04, 4.4220e-02,
            3.2776e-02, -1.9569e-03, -5.9586e-03, 1.1497e-02, -1.9730e-02,
            -2.1591e-02, 1.1635e-02, 1.2589e-02, 2.8613e-01, 2.3743e-02,
            1.2108e-02, -2.5436e-02, -3.0470e-04, -2.4368e-02, 2.1561e-02,
            9.0332e-03, 3.8788e-02, -7.8918e-02, -4.1122e-03, -5.7007e-02,
            -1.0468e-02, 3.7346e-03, -4.7729e-02, -1.9547e-02, 1.8234e-02,
            -4.9347e-02, -1.1612e-02, -8.5144e-02, -1.9012e-02, -2.0065e-02,
            -1.3939e-02, -2.0599e-02, -7.7934e-03, -3.8879e-02, 1.4679e-02,
            3.5645e-02, 4.3610e-02, -1.4618e-02, 1.3702e-02, 2.2766e-02,
            1.6953e-02, 9.6802e-02, 2.0737e-02, 1.2787e-02, 1.3741e-02,
            -4.2267e-03, 6.9160e-03, -1.7609e-02, 9.7427e-03, 3.1921e-02,
            1.0994e-02, 1.9211e-02, -5.6763e-03, 1.0307e-02, -3.0609e-02,
            1.7738e-03, -1.7380e-02, -2.0233e-02, 7.1678e-03, 1.6907e-02,
            -1.8616e-02, 4.9896e-03, -2.8210e-03, 2.7756e-02, -7.8297e-04,
            2.7523e-03, 1.6794e-03, -2.0279e-02, 3.5431e-02, 1.4694e-02,
            -1.4030e-02, 6.4507e-03, 3.7842e-02, 2.2629e-02, -6.4270e-02,
            -5.8937e-03, -6.2408e-03, -1.1620e-02, -2.8290e-02, 3.1494e-02,
            -4.1016e-02, 1.1740e-03, -2.9354e-03, -2.0538e-02, -6.4325e-04,
            6.3591e-03, -6.3477e-03, 1.2718e-02, -1.6418e-02, -1.0307e-02,
            -4.3793e-02, 2.3590e-02, -3.6804e-02, -1.6830e-02, 3.2257e-02,
            5.2223e-03, -3.0289e-02, 4.2877e-03, 7.8735e-03, -5.3223e-02,
            1.4595e-02, -2.4597e-02, 1.1616e-03, -1.6937e-02, 1.4702e-02,
            -5.2185e-03, -1.2798e-03, -4.8065e-02, -2.0645e-02, -8.1253e-03,
            8.8196e-03, 7.2899e-03, 8.0261e-03, -8.9966e-02, 2.0966e-02,
            -5.2948e-02, -2.4734e-02, 9.8877e-03, 5.4108e-02, -1.0078e-02,
            -1.3092e-02, -9.3201e-02, -2.0844e-02, -3.8166e-03, -1.3437e-03,
            -2.6474e-02, -4.4289e-03, 6.0997e-03, 4.9286e-02, -2.3544e-02,
            5.4199e-02, 4.4128e-02, -6.8665e-03, -3.2013e-02, -4.4708e-03,
            -1.0567e-02, 1.1940e-02, -3.3661e-02, 1.0307e-02, -1.4496e-02,
            2.0966e-02, -2.0638e-03, -1.6434e-02, -4.2391e-04, -3.7632e-03,
            -1.2947e-02, 5.0468e-03, 1.3268e-02, -1.9806e-02, 2.0355e-02,
            3.4088e-02, -5.4970e-03, -2.5467e-02, -2.6291e-02, -9.1248e-03,
            1.3435e-02, 2.1265e-01, -2.7161e-02, -2.4536e-02, -2.0172e-02,
            -8.5449e-03, -1.7120e-02, -6.5735e-02, 3.1464e-02, 2.8076e-02,
            4.0741e-02, -3.2406e-03, 9.0027e-03, -2.3346e-02, 1.3145e-02,
            4.9652e-02, -6.1150e-03, -4.6478e-02, -1.0612e-02, 2.6825e-02,
            -7.5760e-03, -3.0327e-03, 1.0338e-02, -1.5404e-02, -7.7209e-02,
            2.3560e-02, 7.4692e-03, 2.7679e-02, -4.9095e-03, -5.4718e-02,
            1.2558e-02, -8.5815e-02, 2.4887e-02, 2.6306e-02, 2.7954e-02,
            1.6586e-02, -8.6451e-04, -1.7654e-02, 1.5701e-02, 8.8074e-02,
            1.8463e-02, -3.2745e-02, 2.2629e-02, 9.0179e-03, -5.4970e-03,
            -2.0432e-02, 2.8534e-03, -1.6495e-02, 1.6327e-02, -7.7477e-03,
            -6.0158e-03, -6.4888e-03, -1.2131e-02, 2.0416e-02, -1.9409e-02,
            6.6376e-03, 2.6291e-02, -4.3854e-02, 1.7258e-02, -1.1864e-03,
            -7.4921e-03, -2.4460e-02, -8.2016e-03, 2.1698e-02, 9.8495e-03,
            -9.6359e-03, 5.2032e-03, 1.0284e-02, -4.4739e-02, 6.3286e-03,
            2.5726e-02, -2.8702e-02, 1.1091e-03, -1.0818e-02, 3.9864e-03,
            -1.6571e-02, -1.1581e-02, -1.5099e-02, -4.6387e-02, 5.2795e-03,
            -4.7302e-04, 6.7566e-02, 1.4404e-02, -2.3117e-02, 1.7838e-02,
            2.2858e-02, -1.5388e-02, 2.9404e-02, -3.3997e-02, -1.7944e-02,
            -9.4910e-03, -3.8391e-02, 1.8173e-02, -8.2169e-03, 3.1891e-02,
            5.4207e-03, -2.7008e-02, 5.1239e-02, 5.1842e-03, -2.4872e-02,
            3.5645e-02, -5.7297e-03, -6.1989e-04, 1.9058e-02, -3.5706e-02,
            6.3095e-03, -3.8666e-02, 1.4191e-03, 1.0376e-02, 1.4885e-02,
            2.0447e-02, -1.0757e-02, -2.9349e-04, -2.5768e-03, -8.8730e-03,
            -5.6267e-04, 1.6754e-02, -3.2928e-02, 2.7664e-02, -5.1666e-02,
            -3.1799e-02, 6.3438e-03, -8.1539e-05, 2.2293e-02, 6.6895e-02,
            1.9379e-02, -1.0269e-02, -2.7809e-03, -2.6077e-02, 4.1733e-03,
            -1.2474e-02, -2.9007e-02, -1.5945e-02, 0.0000e+00, -2.5345e-02,
            -1.7014e-02, -3.1769e-02, -8.9722e-03, 1.5503e-02, -3.1677e-02,
            -1.9646e-03, 2.0020e-02, 1.8616e-02, -1.1511e-01, 3.5820e-03,
            -6.2981e-03, -2.5208e-02, 4.0527e-02, 8.9693e-04, 2.2079e-02,
            -1.6296e-02, -1.7883e-02, 3.1021e-02, 1.9407e-03, -1.0480e-01,
            2.2736e-02, -2.7985e-02, 3.5889e-02, 1.1168e-03, 1.9180e-02,
            -1.6724e-02, -3.3783e-02, -1.3161e-02, -2.5269e-02, 1.2207e-03,
            2.9770e-02, -1.2344e-02, 6.0310e-03, -6.5979e-02, -5.8022e-03,
            4.1168e-02, -8.0795e-03, 1.7452e-03, 2.1133e-02, 2.0737e-02,
            1.4549e-02, -3.4454e-02, -2.3926e-02, 9.0075e-04, -2.6443e-02,
            5.5771e-03, -6.9695e-03, 2.9297e-03, 3.4668e-02, 1.5659e-03,
            6.1951e-03, -1.9836e-02, 1.9569e-03, -4.1687e-02, -4.1382e-02,
            -7.5378e-02, -1.1505e-02, 2.2522e-02, 2.8641e-02, 1.3206e-02,
            -1.9470e-02, 8.8882e-03, -2.2034e-02, 1.2695e-02, 1.6296e-02,
            -1.0284e-02, 1.5327e-02, -9.0561e-03, -4.6310e-03, 1.0254e-02,
            9.0179e-03, -5.9700e-03, -5.9937e-02, 3.6621e-02, -1.3626e-02,
            1.6037e-02, 9.7871e-05, -1.7776e-03, -5.1300e-02, 1.8635e-03,
            -4.8752e-03, 1.7838e-02, -1.3603e-02, -5.4436e-03, 1.6205e-02,
            -4.2999e-02, -3.2867e-02, -4.1870e-02, 8.4782e-04, 2.0187e-02,
            -3.0651e-03, -4.4098e-02, -3.9978e-02, -3.3295e-02, 1.4565e-02,
            -5.4596e-02, -8.7585e-03, 1.3046e-03, -1.8982e-02, 3.3752e-02,
            4.2816e-02, 1.3781e-03, 2.0615e-02, -5.7281e-02, 3.6285e-02,
            -9.0485e-03, 1.6205e-02, 1.0498e-02, -3.6072e-02, 2.1191e-03,
            1.7792e-02, 5.4230e-02, -2.7054e-02, 2.2583e-02, -1.6602e-02,
            -2.2335e-03, -2.9663e-02, -8.9645e-03, -1.9333e-02, -2.4902e-02,
            9.3746e-04, 5.2681e-03, 3.6652e-02, -1.5320e-02, -1.0841e-02,
            -5.4718e-02, 2.5574e-02, -3.2349e-02, 5.4131e-03, -3.8300e-02,
            2.1423e-02, -1.4488e-02, -6.1951e-03, -9.8038e-03, -2.8107e-02,
            2.3315e-02, 6.0272e-02, 6.7139e-03, -2.5833e-02, 1.7929e-02,
            -9.6130e-03, 6.6948e-03, 2.5162e-02, 3.2604e-05, 2.3438e-02,
            -1.7899e-02, 4.7951e-03, -1.5087e-03, -1.7900e-03, -1.9653e-02,
            1.2611e-02, -2.0905e-02, -1.4793e-02, -2.5768e-03, 3.6102e-02,
            -3.9429e-02, -7.3929e-03, 1.1635e-02, -7.4768e-03, -8.9233e-02,
            2.2263e-02, -3.4668e-02, -3.1952e-02, -9.9468e-04, -1.7334e-02,
            -4.9072e-02, 3.5217e-02, -1.0796e-02, -3.8849e-02, 7.6485e-03,
            -4.2725e-02, 2.1927e-02, 3.8567e-03, 2.5726e-02, 3.9864e-03,
            1.3306e-02, -5.2452e-03, -1.2312e-03, 2.5391e-02, -2.3438e-02,
            -1.6449e-02, 2.6611e-02, -1.0582e-02, 1.8372e-02, 1.6861e-02,
            3.6346e-02, -1.3741e-02, -2.5558e-02, 2.8244e-02, 2.4597e-02,
            3.8166e-03, -7.8583e-03, 3.5858e-02, -8.9645e-03, -6.6414e-03,
            -1.6956e-03, 2.5452e-02, -1.4294e-01, 1.0109e-02, 4.0703e-03,
            -1.7380e-02, 3.1433e-02, 1.0391e-02, -9.6588e-03, -6.7520e-03,
            5.5122e-03, -4.1229e-02, 1.3943e-03, 1.5671e-02, 1.0292e-02,
            2.2476e-02, -1.0657e-01, 4.8004e-02, 6.3934e-03, 1.9196e-02,
            9.5581e-02, -5.0392e-03, -1.2474e-02, 1.2482e-02, 2.7191e-02,
            2.4734e-02, 2.2552e-02, 7.6233e-02, -3.1796e-03, 3.1677e-02,
            -1.5175e-02, 3.6865e-02, 1.9592e-02, 1.7487e-02, 2.7100e-02,
            1.5900e-02, 3.4515e-02, 3.2196e-02, -1.9730e-02, -5.5199e-03,
            2.5864e-02, -5.7411e-03, 2.0187e-02, 1.2585e-01, 2.0905e-02,
            -1.3206e-02, 3.8967e-03, -1.8936e-02, -6.6853e-04, 8.2169e-03,
            9.3689e-03, 2.9617e-02, 7.9498e-03, -2.7786e-02, 1.7517e-02,
            -2.7084e-02, -2.9617e-02, -1.6098e-02, 1.5039e-01, 1.1663e-03,
            1.2169e-02, 6.3744e-03, 3.3020e-02, -2.6741e-03, 1.0414e-03,
            2.2446e-02, -2.2202e-03, -2.7435e-02, -3.9459e-02, 3.2562e-02,
            8.8440e-02, 1.1169e-02, 5.2429e-02, 4.8920e-02, 7.9956e-02,
            5.9204e-03, 1.1200e-02, -1.0880e-02, 2.0996e-02, 2.8183e-02,
            9.1028e-04, -2.5955e-02, 4.2391e-04, -1.9272e-02, 3.5065e-02,
            -1.7261e-01, 3.3508e-02, 5.4626e-03, -6.3438e-03, -1.4801e-02,
            -1.5701e-02, -5.0415e-02, 2.7298e-02, -1.1223e-02, 1.6312e-02,
            1.5152e-02, 4.5738e-03, -9.5062e-03, 4.8065e-02, 8.0322e-02,
            -4.0344e-02, 7.9107e-04, 1.5160e-02, 4.5433e-03, -1.5297e-02,
            3.6850e-03, -3.1128e-02, 1.6113e-02, -5.2338e-03, 2.0542e-03,
            -1.3107e-02, 6.0349e-03, -4.8492e-02, 1.1749e-02, -2.5696e-02,
            -5.4626e-03, -4.1473e-02, -1.0239e-02, -2.1591e-03, -6.3095e-03,
            -3.1586e-02, -6.0028e-02, -4.4441e-03, 5.7101e-05, -3.8635e-02,
            1.8982e-02, -2.5574e-02, -1.7452e-03, 2.1027e-02, 3.2935e-01,
            -2.5833e-02, -5.3978e-03, -1.2657e-02, -2.7676e-03, -3.4576e-02,
            -3.3661e-02, 1.0598e-04, -2.8944e-04
        ]]))

    SiGLIP_TEXT_EMBEDDING = np.squeeze(np.array([
        [
            -2.0950e-02, 1.7624e-02, 2.1629e-03, -3.2532e-02, 5.3062e-03,
            2.9190e-02, 9.8343e-03, 8.5068e-03, -2.5589e-02, 2.5234e-03,
            -3.1738e-02, 4.4891e-02, 2.0340e-02, 2.6886e-02, 4.4975e-03,
            1.6861e-02, 2.9129e-02, 4.5891e-03, -2.2766e-02, -9.7513e-04,
            -1.3374e-02, 3.5522e-02, 1.6068e-02, -8.5678e-03, 1.8433e-02,
            -4.3297e-03, 3.1796e-03, 2.1687e-03, 1.0920e-03, 2.6489e-02,
            -1.6602e-02, -6.8130e-03, 1.5404e-02, -1.6602e-02, 1.8112e-02,
            1.2741e-02, -2.4948e-02, -1.3481e-02, 9.2392e-03, 1.1703e-02,
            -3.1528e-03, 2.0737e-02, -1.4839e-03, 2.8801e-03, -2.0035e-02,
            5.1498e-04, 3.5645e-02, -9.9792e-03, 2.3041e-02, 2.1713e-02,
            -2.8717e-02, -2.1530e-02, -2.1683e-02, 1.7212e-02, 1.3466e-02,
            -5.3406e-04, 2.0218e-03, 4.4250e-03, 3.9917e-02, -1.4130e-02,
            -2.5578e-03, -8.3160e-03, 2.2430e-02, 2.2263e-02, 1.2230e-02,
            -1.1475e-02, 7.8812e-03, -1.7118e-04, -2.1271e-02, 2.8717e-02,
            2.0966e-02, 8.8120e-03, -2.0554e-02, -1.2035e-03, 6.8016e-03,
            3.4271e-02, -1.8585e-02, -2.8824e-02, 6.5689e-03, 2.2392e-03,
            -1.5778e-02, -1.3603e-02, 1.3745e-04, -5.0323e-02, -1.5656e-02,
            -2.8625e-02, 2.9434e-02, -1.4114e-02, -3.3447e-02, 1.9318e-02,
            -1.2947e-02, 5.2910e-03, 3.6469e-03, 2.6016e-02, -1.0941e-02,
            1.8738e-02, 2.3453e-02, -6.4812e-03, 5.9479e-02, 3.0594e-02,
            1.8433e-02, -1.1955e-02, 2.2110e-02, 1.1513e-02, 1.4771e-02,
            -1.4572e-02, 3.8239e-02, 2.0767e-02, 2.0264e-02, 6.5956e-03,
            1.1711e-03, -2.2919e-02, 3.4332e-02, 1.1246e-02, 3.5076e-03,
            1.8936e-02, 1.2108e-02, 1.6737e-03, -1.2985e-02, 1.8402e-02,
            -1.4372e-03, -1.7685e-02, -6.4844e-01, 2.4094e-02, 1.7517e-02,
            8.0948e-03, -2.6337e-02, 4.3755e-03, -8.2703e-03, -7.4120e-03,
            3.5126e-02, 1.7075e-02, -1.7502e-02, 1.6586e-02, -3.1860e-02,
            5.7335e-03, -1.9577e-02, 1.1749e-02, -5.6229e-03, 2.9617e-02,
            -6.2943e-03, 9.4452e-03, -3.3661e-02, 1.2886e-02, -6.1569e-03,
            9.6083e-04, 1.3685e-03, 1.4412e-02, -2.0203e-02, -2.0477e-02,
            8.9569e-03, -8.3389e-03, 2.4170e-02, 3.1948e-03, 1.0010e-02,
            2.8214e-02, -3.0533e-02, 2.2186e-02, 2.0814e-04, 7.1449e-03,
            -8.0795e-03, -1.0147e-02, -2.2934e-02, -2.3746e-03, -9.3536e-03,
            -1.2817e-02, -2.6886e-02, 2.6665e-03, -2.8519e-02, 3.7289e-03,
            -7.3280e-03, 4.0070e-02, 1.2207e-02, -2.2537e-02, 8.1253e-03,
            8.1253e-03, -3.9307e-02, -9.0408e-03, -9.0561e-03, 5.8624e-02,
            -1.9424e-02, -1.7365e-02, -1.8177e-03, -1.5457e-02, 2.0676e-02,
            -5.9586e-03, 2.0462e-02, -6.7863e-03, -3.0174e-03, 1.5976e-02,
            1.4885e-02, -6.5994e-03, 2.4246e-02, -3.0502e-02, 1.6357e-02,
            -1.5564e-03, -2.0859e-02, 2.1164e-02, 1.3565e-02, 4.1175e-04,
            1.3084e-03, 1.8204e-02, 4.1504e-03, -2.5833e-02, 1.5266e-02,
            -1.1818e-02, 4.7379e-03, 1.1391e-02, 2.1347e-02, -5.9395e-03,
            1.3474e-02, -2.2018e-02, 4.0512e-03, 3.0197e-02, 1.5602e-03,
            -5.1270e-03, 2.7847e-02, 1.6785e-02, 7.1068e-03, 2.6588e-03,
            -8.9111e-03, 2.4475e-02, 2.7359e-02, 3.4607e-02, -2.3636e-02,
            -2.4170e-02, 6.6872e-03, 7.9575e-03, -3.8483e-02, 3.3752e-02,
            -1.6403e-02, 1.0437e-02, 7.6103e-03, -5.6915e-02, 1.2253e-02,
            6.7234e-05, 9.6359e-03, -4.8332e-03, 1.5068e-02, 2.7557e-02,
            3.3796e-05, -1.9569e-03, -5.1003e-03, -8.5449e-03, 3.0716e-02,
            3.1967e-03, 2.2793e-03, 2.8580e-02, -4.9324e-03, 1.6129e-02,
            -1.2085e-02, 2.0630e-02, -1.8051e-02, -7.1812e-04, 2.3560e-02,
            -5.5199e-03, 6.8604e-02, -1.3451e-02, -2.2690e-02, -5.0659e-02,
            1.4565e-02, -1.2791e-04, -1.5221e-02, -1.7166e-02, 2.2217e-02,
            5.1651e-03, -2.2049e-02, -2.7802e-02, 6.6757e-03, -3.0151e-02,
            -3.9825e-03, -1.8127e-02, -1.2531e-03, -9.6588e-03, -1.0483e-02,
            2.0767e-02, -3.4607e-02, -1.9150e-02, 1.4084e-02, -2.4071e-03,
            -3.2104e-02, -3.5248e-02, -4.5837e-02, 1.5961e-02, -2.5436e-02,
            -2.9938e-02, -2.1591e-03, -2.0416e-02, 1.6388e-02, -6.8092e-03,
            1.6556e-02, -3.0251e-03, 9.6970e-03, -7.1297e-03, 1.9928e-02,
            -5.6122e-02, 9.2649e-04, -2.1076e-03, -2.0752e-02, 2.8648e-03,
            -2.1118e-02, -4.0741e-03, 4.4128e-02, 5.1575e-03, -9.3002e-03,
            2.3956e-02, -6.8626e-03, -7.8049e-03, -2.1439e-02, -1.3268e-02,
            3.4790e-02, 4.1046e-03, -2.1591e-02, 1.7347e-03, 1.7975e-02,
            1.4465e-02, -6.4163e-03, -3.9581e-02, 7.9880e-03, -1.8845e-02,
            -3.3356e-02, 3.3966e-02, -2.8015e-02, -3.8239e-02, -3.4142e-03,
            -1.1772e-02, 2.0313e-03, 1.6907e-02, 5.0354e-03, -2.1545e-02,
            -7.8354e-03, -1.0483e-02, 1.5320e-02, 1.0460e-02, -3.6194e-02,
            5.2032e-02, -1.6113e-02, -1.4412e-02, -1.6159e-02, 1.8631e-02,
            -3.9177e-03, -9.9564e-03, 2.9770e-02, -2.1820e-03, -4.3152e-02,
            -4.3152e-02, -1.7303e-02, -4.1122e-03, -9.2087e-03, 6.1264e-03,
            2.7359e-02, -2.8305e-02, 1.4641e-02, 1.3832e-02, -4.2038e-03,
            1.9577e-02, 3.2745e-02, -8.6441e-03, -3.4332e-02, 9.0561e-03,
            -4.6692e-03, -8.7280e-03, 4.0550e-03, 1.5579e-02, -1.1169e-02,
            -7.3385e-04, -7.6408e-03, -1.9043e-02, -9.0942e-03, 1.7250e-04,
            2.1408e-02, 3.0609e-02, 3.4313e-03, -5.5237e-03, 1.0376e-02,
            -1.5579e-02, -5.3902e-03, -2.5826e-03, -4.1504e-03, -6.5369e-02,
            -1.5686e-02, -1.6098e-02, 7.0114e-03, -2.9190e-02, 1.2917e-02,
            1.8524e-02, 7.0238e-04, 1.3397e-02, 8.9798e-03, 4.6387e-02,
            -5.6732e-02, 1.7517e-02, -1.9775e-02, -2.5986e-02, 3.8330e-02,
            4.0070e-02, 3.2349e-02, 2.1194e-02, -1.8448e-02, 1.4687e-02,
            1.3533e-03, 2.5864e-02, 5.3749e-03, -1.9638e-02, -3.4698e-02,
            1.0796e-02, 1.7319e-02, -1.3618e-02, -4.1107e-02, -8.7967e-03,
            -3.4180e-02, -7.2327e-03, -1.1932e-02, -4.8523e-02, 3.1830e-02,
            8.3694e-03, -5.6992e-03, 1.1078e-02, -2.1515e-02, -1.9836e-02,
            -9.1400e-03, 9.2545e-03, -1.5701e-02, -1.0826e-02, 3.2227e-02,
            6.6710e-04, 1.2260e-02, 6.6833e-03, -2.6962e-02, -1.5688e-03,
            1.4389e-02, 6.1989e-04, 2.5034e-04, -4.1840e-02, -6.7101e-03,
            1.3901e-02, -1.7105e-02, -5.0163e-03, 4.2999e-02, -1.3351e-02,
            1.4336e-02, -8.5678e-03, 1.5087e-03, 8.1329e-03, -2.6382e-02,
            -2.6093e-02, -6.9809e-03, 3.8696e-02, 1.1848e-02, 3.2623e-02,
            -1.5221e-02, -2.5421e-02, 3.8948e-03, 2.1988e-02, 3.4332e-03,
            -2.9411e-03, 3.5339e-02, 1.4977e-02, 2.1687e-03, 2.7557e-02,
            -2.3941e-02, -4.4899e-03, -3.0960e-02, 1.9485e-02, 8.6136e-03,
            1.5274e-02, 1.0406e-02, -7.5607e-03, -1.2009e-02, 5.6496e-03,
            1.3771e-02, 4.3152e-02, -3.3932e-03, 2.2697e-03, 2.6245e-02,
            1.0765e-02, -2.5253e-02, 2.5314e-02, 5.6229e-03, 1.1154e-02,
            5.0926e-03, -6.1371e-02, 3.1250e-02, -7.9880e-03, -1.9089e-02,
            2.1133e-03, -6.1874e-03, -1.8539e-02, 1.7487e-02, 1.0849e-02,
            -1.2909e-02, 1.4381e-02, 2.4704e-02, -1.7670e-02, -4.2725e-03,
            -3.6133e-02, -3.5152e-03, -6.1274e-04, -2.0462e-02, 3.9337e-02,
            -5.0583e-03, 7.3090e-03, -7.9803e-03, 1.7517e-02, 1.0918e-02,
            -3.0502e-02, -4.2999e-02, -3.3112e-02, -2.5940e-02, 1.7212e-02,
            3.6278e-03, -1.0330e-02, 4.5586e-03, 1.1345e-02, -5.2719e-03,
            1.2871e-02, 4.4586e-02, 1.3603e-02, 2.3026e-02, -1.5915e-02,
            -4.1008e-03, -2.2644e-02, 5.1956e-03, -4.0779e-03, -3.0441e-02,
            -2.3300e-02, -4.3060e-02, -2.1851e-02, 1.7136e-02, -1.6525e-02,
            -2.5681e-02, 4.9629e-03, 1.3176e-02, 2.0542e-03, 1.2627e-02,
            -5.4817e-03, 4.3607e-04, 3.7018e-02, -1.1848e-02, -1.6479e-02,
            2.3899e-03, 1.3931e-02, -5.4131e-03, -4.9820e-03, -9.3689e-03,
            -1.4229e-02, -7.8506e-03, -5.2338e-02, -4.3488e-03, -3.2257e-02,
            -3.1311e-02, 1.3397e-02, -2.4292e-02, 3.1395e-03, -1.9363e-02,
            1.6022e-02, 1.8890e-02, 3.8834e-03, -1.5556e-02, 2.6245e-02,
            -1.5945e-03, -1.9211e-02, 2.9411e-03, -2.5360e-02, -1.1337e-02,
            2.1706e-03, 1.2909e-02, -9.5367e-03, 1.2657e-02, 1.5495e-02,
            -2.3758e-02, 1.0422e-02, 8.3847e-03, 3.6163e-02, -9.2649e-04,
            1.5564e-03, 1.3855e-02, -3.0487e-02, -1.6983e-02, 3.0640e-02,
            -1.8448e-02, 1.6632e-02, 9.1553e-03, 2.3483e-02, 9.8648e-03,
            -5.6992e-03, 1.4076e-02, 1.4633e-02, -7.8812e-03, -8.7357e-03,
            -1.6998e-02, -1.0765e-02, -2.5375e-02, -1.3428e-02, -2.7435e-02,
            1.9669e-02, 2.9999e-02, -2.1042e-02, -8.4915e-03, 3.7727e-03,
            3.0396e-02, 8.8120e-03, -2.0370e-03, -2.7054e-02, 2.3071e-02,
            1.3878e-02, 4.1924e-03, -1.1360e-02, -1.1396e-04, -1.6510e-02,
            1.1536e-02, 3.2558e-03, -6.0158e-03, 1.9043e-02, -7.7553e-03,
            4.7035e-03, -8.8272e-03, 5.4893e-03, 8.9264e-03, 1.0490e-02,
            1.5579e-02, 1.7750e-04, 3.0975e-03, 3.4943e-02, 3.6987e-02,
            3.3386e-02, -2.6688e-02, 4.7340e-03, -4.0222e-02, 6.8855e-04,
            7.3357e-03, -4.5815e-03, -2.9877e-02, 1.2505e-02, 8.9264e-04,
            5.0732e-01, -3.5820e-03, 3.1799e-02, -8.5297e-03, -1.5625e-02,
            1.5205e-02, 7.5111e-03, 8.1863e-03, -4.0009e-02, -1.0246e-02,
            -1.2306e-02, 2.1912e-02, 4.4861e-03, -3.4943e-02, 7.6714e-03,
            -6.0043e-03, 1.5701e-02, 2.7664e-02, 1.0424e-03, 2.0050e-02,
            1.1124e-02, 3.4424e-02, 2.7390e-02, -2.7065e-03, 1.9745e-02,
            -6.1760e-03, 1.5144e-02, -1.0460e-02, 3.9429e-02, -3.6774e-03,
            3.4576e-02, -2.8992e-03, -1.6037e-02, 4.3793e-03, 2.1667e-02,
            -8.7967e-03, 1.9424e-02, 1.5205e-02, 1.8661e-02, -2.0050e-02,
            -1.6449e-02, -2.2842e-02, -1.5106e-03, 1.5888e-03, 2.3956e-02,
            1.2222e-02, 2.8961e-02, 1.2755e-04, -2.0660e-02, -5.6801e-03,
            -3.5095e-02, 2.1439e-03, -5.1758e-02, 2.1496e-03, -9.6512e-03,
            3.2074e-02, -1.1459e-02, -7.7019e-03, 2.4471e-03, 7.5483e-04,
            1.7223e-03, 3.7537e-02, 8.6594e-03, 1.4252e-02, 9.6741e-03,
            3.7811e-02, -2.4261e-02, 1.1055e-02, 2.3956e-02, 8.1711e-03,
            8.9417e-03, 1.9424e-02, 1.7441e-02, 1.1650e-02, -7.4863e-05,
            -9.2010e-03, -1.1192e-02, -1.6449e-02, -2.8473e-02, -2.7435e-02,
            -2.9938e-02, -5.6419e-03, -1.5327e-02, -1.7914e-02, 1.2459e-02,
            -2.0706e-02, -3.4370e-03, -1.3199e-02, -5.9662e-02, 2.3743e-02,
            -3.3081e-02, -8.3923e-03, -8.6441e-03, -2.8870e-02, 3.2623e-02,
            2.6642e-02, -3.0807e-02, -2.4548e-03, -4.6753e-02, 1.9241e-02,
            2.7237e-02, 5.4703e-03, -6.4201e-03, -1.2962e-02, -3.8971e-02,
            3.2101e-03, 2.6230e-02, -3.1952e-02, -2.8824e-02, 1.3809e-02,
            5.5634e-02, -7.3814e-03, -1.3161e-02, -1.1284e-02, -1.5556e-02,
            -1.0925e-02, -1.4214e-02, 1.6251e-02, 3.2501e-02, -2.5070e-02,
            1.1589e-02, -2.8667e-03, 7.2556e-03, 7.4120e-03, 8.1940e-03,
            2.4475e-02, 3.7994e-02, 3.8452e-02, -6.1913e-03, -3.5739e-04,
            -3.1860e-02, -1.2660e-04, -3.9005e-03
        ]
    ]))

    def setUp(self):
        clear_loaded_models()

    def tearDown(self):
        clear_loaded_models()

    def test_MarqoFashionSigLIPModel_load(self):
        """Test the load method of MarqoFashionCLIPModel."""

        model_tag = "Marqo/marqo-fashionSigLIP"
        model_properties = OPEN_CLIP_MODEL_PROPERTIES[model_tag]
        model = OPEN_CLIP(device="cpu", model_properties=model_properties)

        model.load()

        self.assertIsNotNone(model.model)
        self.assertIsNotNone(model.tokenizer)
        self.assertIsNotNone(model.preprocess)

        marqo_image_embeddings = np.squeeze(np.array(model.encode(self.IMAGE_CONTENT)))
        marqo_text_embeddings = np.squeeze(np.array(model.encode(self.TEXT_CONTENT)))

        image_difference = np.linalg.norm(marqo_image_embeddings - self.SiGLIP_IMAGE_EMBEDDING) / len(
            marqo_image_embeddings)
        text_difference = np.linalg.norm(marqo_text_embeddings - self.SiGLIP_TEXT_EMBEDDING) / len(
            marqo_text_embeddings)

        self.assertLess(image_difference, 1e-4, f"Image embeddings are not close enough. "
                                                f"The average difference is: {image_difference}")
        self.assertLess(text_difference, 1e-4, f"Text embeddings are not close enough. "
                                               f"The average difference is: {text_difference}")

    def test_MarqoFashionCLIPModel_load(self):
        """Test the load method of MarqoFashionCLIPModel."""

        model_tag = "Marqo/marqo-fashionCLIP"
        model_properties = OPEN_CLIP_MODEL_PROPERTIES[model_tag]
        model = OPEN_CLIP(device="cpu", model_properties=model_properties)

        model.load()

        self.assertIsNotNone(model.model)
        self.assertIsNotNone(model.tokenizer)
        self.assertIsNotNone(model.preprocess)

        marqo_image_embeddings = np.squeeze(np.array(model.encode(self.IMAGE_CONTENT)))
        marqo_text_embeddings = np.squeeze(np.array(model.encode(self.TEXT_CONTENT)))

        image_difference = (np.linalg.norm(marqo_image_embeddings - self.FASHIONCLIP_IMAGE_EMBEDDING)
                            / len(marqo_image_embeddings))
        text_difference = (np.linalg.norm(marqo_text_embeddings - self.FASHIONCLIP_TEXT_EMBEDDING)
                           / len(marqo_text_embeddings))

        self.assertLess(image_difference, 1e-4, f"Image embeddings are not close enough. "
                                                f"The average difference is: {image_difference}")
        self.assertLess(text_difference, 1e-4, f"Text embeddings are not close enough. "
                                               f"The average difference is: {text_difference}")
